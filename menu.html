<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© - Ø¥Ø¯Ø§Ø±Ø© Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ù…Ø·Ø¹Ù…</title>

<link rel="manifest" href="manifest.json">

<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js')
    .then(() => console.log('Service Worker Ù…Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­'))
    .catch(() => console.log('ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Service Worker'));
}
</script>

<style>
body { font-family: system-ui, sans-serif; margin: 18px; }
button { font-size: 16px; padding: 12px; margin: 6px 0; width: 100%; }
h1 { margin-bottom: 12px; }
#clients { margin-top: 20px; }
.client {
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 10px;
  margin-bottom: 10px;
}
.client-buttons {
  margin-top: 8px;
  display: flex;
  gap: 8px;
}
.client-buttons button {
  flex: 1;
  padding: 8px;
  font-size: 14px;
  cursor: pointer;
}
</style>
</head>
<body>
  <h1>ğŸ“‹ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h1>
  <button onclick="location.href='add.html'">â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„</button>
  <button onclick="location.href='consume.html'">ğŸ½ï¸ ØªØ³Ø¬ÙŠÙ„ Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ ÙˆØ¬Ø¨Ø©</button>
  <button onclick="location.href='import.html'">â¬†ï¸ Ø§Ø³ØªÙŠØ±Ø§Ø¯ / â¬‡ï¸ ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª</button>

  <h2>ğŸ‘¥ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…Ø³Ø¬Ù„ÙˆÙ†</h2>
  <div id="clients">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>

  <p style="color:#666; margin-top: 20px;">
    Ø§ÙØªØ­ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù ÙÙŠ Ù…ØªØµÙØ­ Chrome. Ø¨Ø¹Ø¯ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ØŒ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØªÙ‡ Ù„Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„ØªØ´ØºÙŠÙ„Ù‡ ÙƒØªØ·Ø¨ÙŠÙ‚ Ù…Ø³ØªÙ‚Ù„.
  </p>

  <!-- Firebase + Firestore -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, collection, getDocs, deleteDoc, doc } 
      from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAjcqetH5vq7fZSV4vwPib-MIoHt4qrVBk",
      authDomain: "make-difference.firebaseapp.com",
      projectId: "make-difference",
      storageBucket: "make-difference.appspot.com",
      messagingSenderId: "114117498973",
      appId: "1:114117498973:web:87567e7a3a181c88e4d5b4",
      measurementId: "G-YWWMPR5NTY"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function loadClients() {
      const container = document.getElementById("clients");
      container.innerHTML = "Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...";

      try {
        const querySnapshot = await getDocs(collection(db, "subscriptions"));
        if (querySnapshot.empty) {
          container.innerHTML = "<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø³Ø¬Ù„ÙˆÙ† Ø¨Ø¹Ø¯.</p>";
          return;
        }

        container.innerHTML = "";
        querySnapshot.forEach((docSnap) => {
          const data = docSnap.data();
          const div = document.createElement("div");
          div.className = "client";
          div.innerHTML = `
            <strong>ğŸ“Œ ${data.name}</strong><br>
            â˜ï¸ ${data.phone}<br>
            ğŸ†” ${data.id}<br>
            ğŸ¥— Ø§Ø´ØªØ±Ø§Ùƒ: ${data.subName || "-"}<br>
            ğŸ“… Ù…Ù† ${data.startDate} Ø¥Ù„Ù‰ ${data.endDate}
          `;

          // Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø­Ø°Ù
          const btns = document.createElement("div");
          btns.className = "client-buttons";

          const editBtn = document.createElement("button");
          editBtn.textContent = "âœï¸ ØªØ¹Ø¯ÙŠÙ„";
          editBtn.onclick = () => {
            location.href = `search.html?doc=${docSnap.id}`;
          };

          const delBtn = document.createElement("button");
          delBtn.textContent = "ğŸ—‘ï¸ Ø­Ø°Ù";
          delBtn.style.background = "#f44336";
          delBtn.style.color = "#fff";
          delBtn.onclick = async () => {
            if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„ØŸ")) {
              await deleteDoc(doc(db, "subscriptions", docSnap.id));
              alert("ØªÙ… Ø§Ù„Ø­Ø°Ù âœ…");
              loadClients(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù
            }
          };

          btns.appendChild(editBtn);
          btns.appendChild(delBtn);
          div.appendChild(btns);

          container.appendChild(div);
        });
      } catch (err) {
        console.error(err);
        container.innerHTML = "<p style='color:red'>ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase.</p>";
      }
    }

    loadClients();
  </script>
</body>
</html>
