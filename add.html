<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>โ ุฅุถุงูุฉ ุนููู ุฌุฏูุฏ</title>
<style>
body { font-family: sans-serif; margin:16px; }
label { display:block; margin-top:8px; }
input, button { font-size:16px; padding:8px; width:100%; box-sizing:border-box; }
button { margin-top:12px; }
#msg { font-weight:bold; color:green; margin-top:8px; }
</style>
</head>
<body>
<h1>โ ุฅุถุงูุฉ ุนููู ุฌุฏูุฏ</h1>

<label>ID</label><input id="id">
<label>ุงูุงุณู</label><input id="name">
<label>ุงูุฌูุงู</label><input id="phone">
<label>ููุน ุงูุงุดุชุฑุงู</label><input id="subName">
<label>ุชุงุฑูุฎ ุงูุจุฏุงูุฉ</label><input id="startDate" type="date">
<label>ุงููุฏุฉ (ุฃูุงู)</label><input id="duration" type="number">
<label>ุฏุฌุงุฌ</label><input id="chicken" type="number">
<label>ูุญู</label><input id="meat" type="number">
<label>ุณูู</label><input id="fish" type="number">
<label>ุณูุงู</label><input id="snack" type="number">

<button id="saveBtn">๐พ ุญูุธ ุงูุนููู</button>
<p id="msg"></p>
<hr>
<button onclick="location.href='index.html'">โฌ ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ</button>

<script>
const DB='ClientsDB', STORE='clients', DAY_MS=24*60*60*1000;
function openDB(){ return new Promise((res,rej)=>{ const r=indexedDB.open(DB,1); r.onupgradeneeded=e=>e.target.result.createObjectStore(STORE,{keyPath:'id'}); r.onsuccess=e=>res(e.target.result); r.onerror=e=>rej(e.target.error); }); }
function saveClient(c){ return openDB().then(db=>new Promise((res,rej)=>{ const tx=db.transaction(STORE,'readwrite'); tx.objectStore(STORE).put(c); tx.oncomplete=()=>res(); tx.onerror=()=>rej(tx.error); })); }

document.getElementById('saveBtn').onclick=async()=>{
  const id=document.getElementById('id').value.trim();
  if(!id){ alert('ุงุฏุฎู ID'); return; }
  const client={
    id:id,
    name:document.getElementById('name').value.trim(),
    phone:document.getElementById('phone').value.trim(),
    subName:document.getElementById('subName').value.trim(),
    startDate:document.getElementById('startDate').value,
    duration:parseInt(document.getElementById('duration').value)||0,
    endDate:new Date(new Date(document.getElementById('startDate').value).getTime()+(parseInt(document.getElementById('duration').value)||0)*DAY_MS).toISOString().slice(0,10),
    remaining:{
      ุฏุฌุงุฌ:parseInt(document.getElementById('chicken').value)||0,
      ูุญู:parseInt(document.getElementById('meat').value)||0,
      ุณูู:parseInt(document.getElementById('fish').value)||0,
      ุณูุงู:parseInt(document.getElementById('snack').value)||0
    },
    createdAt:new Date().toISOString()
  };
  await saveClient(client);
  document.getElementById('msg').textContent='โ ุชู ุญูุธ ุงูุนููู ุจูุฌุงุญ';
  setTimeout(()=>location.href='index.html',1000);
};
</script>
</body>
</html>
